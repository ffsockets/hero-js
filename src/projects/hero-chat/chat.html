<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src='/socket.io/socket.io.js'></script>
  <!-- <script src="./app/autoRefresh.js"></script> -->
  <script src="./app/config.js"></script>
  <script src="./app/shareViews.js"></script>
  <script src="./app/herohelper.js"></script>
  <script src="./app/fu.js"></script>
  <script src="./app/hero.js"></script>
  <script>
  // var msgs = [

  //   {
  //     text:'Hi, What \'s are you doing?',
  //     self:false,
  //     nickname:'Vitalik',
  //     avatar:'https://img2.woyaogexing.com/2018/11/05/e37eafb8923f4f62!400x400_big.jpg' 
  //   },
  //   {
  //     text:'Buy more eth !!',
  //     self:true,
  //     nickname:'Me',
  //     avatar:'https://img2.woyaogexing.com/2018/11/09/2ab8e98a388a5251!400x400_big.jpg' 
  //   },

  // ];


    Hero.on = function(data){
      if (data.msg) {
        Hero.addMsg(data.msg);
      };
    };
    var i = 0;
    Hero.job = function(){
      var msg = msgs[i];
      Hero.out({datas:{name:'chat',newMsg:msg}});
      if (i < msgs.length) {
        i++
      }else{
        return;
      }
      setTimeout(function(){
        Hero.job();
      },2000)
    }
    Hero.addMsg = function(text){
      var msg = {self:true,nickname:'Me',text:text};
      window._io.emit('heroChat', {req:'post',payload:msg});
      Hero.datas({name:'chat',newMsg:msg,avatar:''});
    };
    Hero.viewWillAppear = function() {
      if (!window._io) {
        window._io = io.connect();
        window._io.on('heroChat', function(data) {
          // hero.out(data);
          alert(JSON.stringify(data));
          if (data.req === 'chatConnect' && data.res === 'success') {
            window._io.emit('heroChat', {req:'fetch'});
            window._io.emit('subscribe')
          }
        });
      };
      var address = Hero.getInitData().address;
      window._io.emit('heroChat', {req:'chatConnect','from':localStorage.chatAcount,'to':address});
      
    };
    Hero.viewWillDisAppear = function() {

    };
    Hero.viewDidload = function() {

    };
    Hero.ui = {
      nav:{
        title:Hero.getInitData().title,
        navigationBarHidden:false
      },
      views:
      [
        {
          class:'HeroChatView',
          frame:{w:'1x',h:'1x'},
          name:'chat'
        },
      ]
    };

  </script>
</head>
<body>
</body>
</html>
